<% if @stones.present? %>
  <% stone_ids = @stones.pluck(:id) %>
  <div class="text-right">
    <%= link_to download_bundle_label_stones_path(ids: stone_ids) do %>
      <%= bi_icon('tag') %>
    <% end %>
    ,<%= link_to(image_tag("icon_pdf_1.png", size: "24x24"), download_bundle_card_stones_path(ids: stone_ids)) %>,
    and <%= link_to("A4", download_bundle_card_stones_path(ids: stone_ids, a4: true)) %>
  </div>
<% end %>

<%= form_for Stone.new, url: bundle_update_stones_path do |f| %>

<% if params[:toggle_column] == "expand" %>
<%= hidden_field_tag :toggle_column, params[:toggle_column] %>
<% end %>

<table class="table table-sm table-striped">
  <thead>
    <tr>
      <th></th>
    <th>name</th>
      <th>parent</th>
      <th>Labname</th>
      <th>IGSN</th>   
     <%= th_if_expand do %>
        Analysis
      <% end %>
     <%= th_if_expand do %>
        File
      <% end %>                 
      <th><%= Place.model_name.human %></th>        
     <%= th_if_expand do %>
	 <%=  Stone.human_attribute_name("date")%>     
      <% end %>     
      <%= th_if_expand do %>
	 <%=  Collection.model_name.human %>
      <% end %>
	<%= th_if_expand do %>
        <%=  Box.model_name.human %>
      <% end %>      
      <th><%= Classification.model_name.human  %></th>
 <% if false %>           <%= th_if_expand "tags" %><!-- don't sort --> <% end %>
      <%= th_if_expand do %>
        <%= "owner" %>
      <% end %>
      <th>  <%= "group" %></th>
      <%= th_if_expand do %>
        <%= "published" %>
      <% end %>
      <th><%= "updated-at" %></th>
      <%= th_if_expand do %>
        <%="created-at" %>
      <% end %>
      <th><%= toggle_column_link method: "post" %></th>
    </tr>
  </thead>
  <tbody>
    <%= render partial: :stone, collection: @stones, locals: { checked: true } %>
  </tbody>
  <tfoot>
    <tr>
      <th><%= check_box_tag nil, nil, true, class: "select-row-all" %></th>
      <th></th>
      <th>
	<div class="input-group">
	  <%= f.text_field :parent_global_id, class: "form-control input-sm" %>
	  <span class="input-group-text">
	    <%= link_to stones_path(per_page: 10, format: :modal), "data-bs-toggle" => "modal", "data-bs-target" => "#search-modal", "data-input" => "#stone_parent_global_id" do %>
	    <%= bi_icon('search') %>
	    <% end %>
	  </span>
	</div>
      </th>
      <th> <%= f.text_field :labname, class: "form-control input-sm" %></th>
      <th></th>
     <%= th_if_expand do %>
	  <div class="input-group">
   	    <%= f.select :analysis_global_id, Analysis.choose_global_id(@current_user), { include_blank: true }, class: "form-control input-sm" %>
	    <span class="input-group-text">
	      <%= link_to analyses_path(per_page: 10, format: :modal), "data-bs-toggle" => "modal", "data-bs-target" => "#search-modal", "data-input" => "#stone_analysis_global_id" do %>
	      <%= bi_icon('search') %>
	      <% end %>
	    </span>
	  </div>
      <% end %>                 
     <%= th_if_expand do %>
	  <div class="input-group">
   	    <%= f.select :attachment_file_global_id, AttachmentFile.choose_global_id(@current_user), { include_blank: true }, class: "form-control input-sm" %>
	    <span class="input-group-text">
	      <%= link_to attachment_files_path(per_page: 10, format: :modal), "data-bs-toggle" => "modal", "data-bs-target" => "#search-modal", "data-input" => "#stone_attachment_file_global_id" do %>
	      <%= bi_icon('search') %>
	      <% end %>
	    </span>
	  </div>
      <% end %>                    
      <th>
    <div class="input-group">
    
      <%= f.select :place_global_id, Place.choose_global_id(@current_user), {  include_blank: true  }, class: "form-control input-sm" %>         
      <span class="input-group-text">
	<%= link_to places_path(per_page: 10, format: :modal), "data-bs-toggle" => "modal", "data-bs-target" => "#search-modal", "data-input" => "#stone_place_global_id" do %>
	<%= bi_icon('search') %>
	<% end %>
      </span>
    </div>      
      </th>
      <%= th_if_expand do %>
		<%= f.text_field :date, class: "form-control input-sm datepicker" %>    
      <% end %>
      <%= th_if_expand do %>
	    <div class="input-group">
	      <%= f.select :collection_global_id, Collection.choose_global_id(@current_user), {  include_blank: true  }, class: "form-control input-sm" %>
	      <span class="input-group-text">
		<%= link_to collections_path(per_page: 10, format: :modal), "data-bs-toggle" => "modal", "data-bs-target" => "#search-modal", "data-input" => "#stone_collection_global_id" do %>
		<%= bi_icon('search') %>
		<% end %>
	      </span>
	    </div>
      <% end %>      
      <%= th_if_expand do %>
        <div class="input-group">
          <%= f.text_field :box_global_id, class: "form-control input-sm" %>
	  <span class="input-group-text">
	    <%= link_to boxes_path(per_page: 10, format: :modal), "data-bs-toggle" => "modal", "data-bs-target" => "#search-modal", "data-input" => "#stone_box_global_id" do %>
	    <%= bi_icon('search') %>
	    <% end %>
	  </span>
	</div>
      <% end %>
<% if false %>
	<th><%= f.select :physical_form_id, PhysicalForm.order(:name).pluck(:name, :id), { include_blank: true }, class: "form-control input-sm" %></th>
<% end %>
      <th><%= f.select :classification_id, Classification.order(:name).pluck(:name, :id), { include_blank: true }, class: "form-control input-sm" %></th>
<% if false %>      
	<%= th_if_expand do %>
		<%= f.text_field :tag_list, class: "form-control input-sm" %>
        <% end %>
<% end %>
      <%= th_if_expand do %>
        <%= f.select :user_id ,User.order(:username).pluck(:username, :id), { include_blank: true }, class: "form-control input-sm" %>
      <% end %>
      <th><%= f.select :group_id ,@current_user.groups.order(:name).pluck(:name, :id), { include_blank: true }, class: "form-control input-sm" %></th>
      <%= th_if_expand do %>
        <%= f.select :published ,[true, false], { include_blank: true }, class: "form-control input-sm" %>
      <% end %>
      <th>
        <%= f.button class: "btn btn-secondary btn-sm" do %>
          <%= bi_icon('save') %>
        <% end %>
      </th>
      <th></th>
    </tr>
  </tfoot>
</table>
<% end %>
