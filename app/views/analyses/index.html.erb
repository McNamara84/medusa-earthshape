<%= paginate @analyses %>
<table class="table table-condensed table-striped">
  <thead>
    <%= search_form_for @search do |f| %>
    <tr>
      <th>
        <%= f.button class: "btn btn-default" do %>
        <span class="glyphicon glyphicon-refresh"></span>
        <% end %>
      </th>
      <th><%= sort_link @search, :name, "name" %></th>
      <th><%= sort_link @search, :device_name, "device" %></th>
      <th><%= sort_link @search, :stone_name, "stone" %></th>
      <th>summary</th>
      <th><%= sort_link @search, :user_username, "owner" %></th>
      <th><%= sort_link @search, :group_name, "group" %></th>
      <th><%= sort_link @search, :record_property_published_at, "published" %></th>
      <th><%= sort_link @search, :updated_at, "updated_at" %></th>
      <th><%= sort_link @search, :created_at, "created_at" %></th>
    </tr>
    <tr>
      <th><%= text_field_tag :per_page, (params[:per_page] || Analysis.default_per_page), size: 4 %></th>
      <th><%= f.text_field :name_cont %></th>
      <th><%= f.text_field :device_name_cont %></th>
      <th><%= f.text_field :stone_name_cont %></th>
      <th></th>
      <th><%= f.text_field :user_username_cont %></th>
      <th><%= f.text_field :group_name_cont %></th>
      <th><%= f.select :record_property_published_eq, [true, false], include_blank: true %></th>
      <th>
        <%= f.text_field :updated_at_gteq, class: 'datepicker', placeholder: "from:", value: format_date(params[:q] && params[:q][:updated_at_gteq]) %>
      </th>
      <th>
        <%= f.text_field :created_at_gteq, class: 'datepicker', placeholder: "from:", value: format_date(params[:q] && params[:q][:created_at_gteq]) %>
      </th>
    </tr>
    <tr>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th>
        <%= f.text_field :updated_at_lteq_end_of_day, class: 'datepicker', placeholder: "to:", value: format_date(params[:q] && params[:q][:updated_at_lteq_end_of_day]) %>
      </th>
      <th>
        <%= f.text_field :created_at_lteq_end_of_day, class: 'datepicker', placeholder: "to:", value: format_date(params[:q] && params[:q][:created_at_lteq_end_of_day]) %>
      </th>
    </tr>
    <% end %>
  </thead>
  <tbody>
    <%= form_tag bundle_edit_analyses_path, id: "bundle-form" do %>
    <%= render partial: :analysis, collection: @analyses, locals: { checked: false } %>
    <% end %>
  </tbody>
  <tfoot>
    <%= render partial: "new", locals: { analysis: Analysis.new } %>
  </tfoot>
</table>
<%= link_to_function "edit", "$('#bundle-form').submit();", class: "btn btn-default" %>

<div id="csv-control">
  To create analysis records at once, download a template (
  <% MeasurementCategory.pluck(:name, :id).each do |name, id| %>
    <%= link_to name, new_analysis_path(format: :csv, measurement_category_id: id) %>
  <% end %>
  ),<br/>and modify, then upload.
  <%= form_tag(import_analyses_path, method: :post, multipart: true) do %>
    <%= file_field_tag :data %>
    <%= submit_tag :upload %>
  <% end %>
</div>

<%= javascript_tag do %>
  $(document).on("succeed.ajaxForm", "#new_analysis", function() {
    $("#analysis_search").submit();
  });
<% end %>
